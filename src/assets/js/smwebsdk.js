!function e(t,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var o=n();for(var r in o)("object"==typeof exports?exports:t)[r]=o[r]}}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,(function(t){return e[t]}).bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function t(){return e.default}:function t(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";n.r(t),n.d(t,"UserMedia",function(){return o}),n.d(t,"Persona",function(){return h}),n.d(t,"Scene",function(){return eF}),n.d(t,"SceneOptions",function(){}),n.d(t,"ConnectOptions",function(){}),n.d(t,"SmEvent",function(){return d}),n.d(t,"WebsocketKind",function(){return i}),n.d(t,"ContentAwareness",function(){return eV}),n.d(t,"smwebsdk",function(){return ez});var o,r,i,s,a,c,u,l,d=function(){function e(){this._callbacks=[]}return e.prototype.addListener=function(e){this._callbacks.push(e)},e.prototype.removeListener=function(e){var t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)},e.prototype.call=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._callbacks.forEach(function(t){t.apply(t,e)},this)},e}(),h=function(){function e(e,t){this._scene=e,this._personaId=t,this._scene.onConversationResultEvents[t]||(this._scene.onConversationResultEvents[t]=new d),this._onConversationResultEvent=this._scene.onConversationResultEvents[t],this._scene.onSpeechMarkerEvents[t]||(this._scene.onSpeechMarkerEvents[t]=new d),this._onSpeechMarkerEvent=this._scene.onSpeechMarkerEvents[t]}return e.prototype.startSpeaking=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var o={personaId:this._personaId,text:e};return t&&(o.context=t),n&&(o.optionalArgs=n),this._scene.sendRequest("startSpeaking",o)},e.prototype.stopSpeaking=function(){console.log("hello");var e={personaId:this._personaId};return this._scene.sendRequest("stopSpeaking",e)},e.prototype.conversationSend=function(e,t,n){var o={personaId:this._personaId,text:e,variables:t,optionalArgs:n};return this._scene.sendRequest("conversationSend",o)},e.prototype.conversationSetVariables=function(e){var t={personaId:this._personaId,variables:e};return this._scene.sendRequest("conversationSetVariables",t)},e.prototype.conversationGetVariables=function(){var e={personaId:this._personaId};return this._scene.sendRequest("conversationGetVariables",e)},e.prototype.animateToNamedCameraWithOrbitPan=function(e,t,n,o,r,i){var s={personaId:this._personaId,cameraName:e,time:t,orbitDegX:n,orbitDegY:o,panDeg:r,tiltDeg:i};return this._scene.sendRequest("animateToNamedCamera",s)},e.prototype.playAnimation=function(e){var t={personaId:this._personaId,animation:e};return this._scene.sendRequest("playAnimation",t)},e.prototype.getVariables=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n="");var o={personaId:this._personaId,names:e,errorTolerant:t,format:n};return this._scene.sendRequest("getVariables",o)},e.prototype.setVariables=function(e){var t={personaId:this._personaId,Variables:e};return this._scene.sendRequest("setVariables",t)},e.prototype.setVariablesOneway=function(e){var t={personaId:this._personaId,Variables:e};this._scene.sendOnewaySceneRequest("setVariables",t)},e.prototype.getVariablesList=function(){var e={personaId:this._personaId};return this._scene.sendRequest("getVariablesList",e)},e.prototype.getModelVariablesList=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariablesList",t)},e.prototype.getModelChildren=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelChildren",t)},e.prototype.getModelFilterSearchResult=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelFilterSearchResult",t)},e.prototype.getModelVariableFilterSearchResult=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariableFilterSearchResult",t)},e.prototype.getConnectorEntries=function(e){var t={personaId:this._personaId,model:e};return this._scene.sendRequest("getConnectorEntries",t)},e.prototype.startBlProfiling=function(){var e={personaId:this._personaId};return this._scene.sendRequest("startBlProfiling",e)},e.prototype.stopBlProfiling=function(e){var t={personaId:this._personaId,reverse:e};return this._scene.sendRequest("stopBlProfiling",t)},e.prototype.getModelHierarchy=function(e){var t={personaId:this._personaId,model:e};return this._scene.sendRequest("getModelHierarchy",t)},e.prototype.createMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("createMonitorSet",n)},e.prototype.removeMonitorSet=function(e){var t={personaId:this._personaId,setName:[{SetName:e}]};return this._scene.sendRequest("removeMonitorSet",t)},e.prototype.addVariableToMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("addVariableToMonitorSet",n)},e.prototype.removeVariableFromMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("removeVariableFromMonitorSet",n)},e.prototype.renderModel=function(e){var t={personaId:this._personaId,modelName:e};return this._scene.sendRequest("renderModel",t)},Object.defineProperty(e.prototype,"onConversationResultEvent",{get:function(){return this._onConversationResultEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSpeechMarkerEvent",{get:function(){return this._onSpeechMarkerEvent},enumerable:!1,configurable:!0}),e}(),p=function(e,t){return(p=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},f=function(){return(f=Object.assign||function e(t){for(var n,o=1,r=arguments.length;o<r;o++)for(var i in n=arguments[o])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};function g(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&0>t.indexOf(o)&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)0>t.indexOf(o[r])&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]]);return n}function v(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function m(e,t){return function(n,o){t(n,o,e)}}function y(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function b(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{c(o.next(e))}catch(t){i(t)}}function a(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((o=o.apply(e,t||[])).next())})}function $(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function i(a){if(n)throw TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([i,a])}}}var C=Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]};function S(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||C(t,e,n)}function E(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function M(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}function w(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var o=Array(e),r=0,t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,r++)o[r]=i[s];return o}function T(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}function k(e){return this instanceof k?(this.v=e,this):new k(e)}function R(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var o,r=n.apply(e,t||[]),i=[];return o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o;function s(e){r[e]&&(o[e]=function(t){return new Promise(function(n,o){i.push([e,t,n,o])>1||a(e,t)})})}function a(e,t){try{var n;n=r[e](t),n.value instanceof k?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(o){l(i[0][3],o)}}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function _(e){var t,n;return t={},o("next"),o("throw",function(e){throw e}),o("return"),t[Symbol.iterator]=function(){return this},t;function o(o,r){t[o]=e[o]?function(t){return(n=!n)?{value:k(e[o](t)),done:"return"===o}:r?r(t):t}:r}}function A(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=E(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(n){t[n]=e[n]&&function(t){return new Promise(function(o,r){!function e(t,n,o,r){Promise.resolve(r).then(function(e){t({value:e,done:o})},n)}(o,r,(t=e[n](t)).done,t.value)})}}}function I(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var O=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&C(t,e,n);return O(t,e),t}function x(e){return e&&e.__esModule?e:{default:e}}function U(e,t,n,o){if("a"===n&&!o)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(e):o?o.value:t.get(e)}function L(e,t,n,o,r){if("m"===o)throw TypeError("Private method is not writable");if("a"===o&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?r.call(e,n):r?r.value=n:t.set(e,n),n}var D=function(){function e(){var e=this;this.state="pending",this.fate="unresolved",this.promise=new Promise(function(t,n){e._resolve=t,e._reject=n}),this.promise.then(function(){return e.state="fulfilled"},function(){return e.state="rejected"})}return e.prototype.resolve=function(e){if("resolved"===this.fate){console.error("Deferred cannot be resolved twice");return}this.fate="resolved",this._resolve(e)},e.prototype.reject=function(e){if("resolved"===this.fate){console.error("Deferred cannot be resolved twice");return}this.fate="resolved",this._reject(e)},e.prototype.isResolved=function(){return"resolved"===this.fate},e.prototype.isPending=function(){return"pending"===this.state},e.prototype.isFulfilled=function(){return"fulfilled"===this.state},e.prototype.isRejected=function(){return"rejected"===this.state},e}(),N=function(){function e(){this._hasMicrophone=!1,this._hasCamera=!1,this._isAndroid=!1,this._isBrowserSupported=!1,this._isEdge=!1,this._isIos=!1,this._isAndroid=this.detectAndroid(),this._isEdge=this.detectEdge(),this._isIos=this.detectIos()}return e.prototype.detectEdge=function(){return this.userAgentMatches("Edge")},e.prototype.detectAndroid=function(){return this.userAgentMatches("Android")},e.prototype.detectIos=function(){return(/iPad|iPhone|iPod/i.test(navigator.platform)||navigator&&"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream},e.prototype.userAgentMatches=function(e){var t=window.navigator.userAgent.match(e);return!!t&&t.length>0},e.prototype.detectWebRTCFeatures=function(){var e=this;return new Promise(function(t,n){window.SmIsUnderRuntimeHost&&(e._isBrowserSupported=!0,e._hasMicrophone=!0,e._hasCamera=!0,t(e));var o=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer",].forEach(function(e){!o&&e in window&&(o=!0)});var r=navigator.userAgent.match(/iPhone|iPad|iPod/i)&&!window.MSStream,i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);o&&r&&!i&&(o=!1),e._isBrowserSupported=o,e._isBrowserSupported||t(e);var s=null;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(s=function(e){Promise.resolve(navigator.mediaDevices.enumerateDevices()).then(function(t){void 0===t&&(t=[]),e(t)}).catch(function(){e([])})});var a=window.MediaStreamTrack;!s&&a&&a.getSources&&(s=a.getSources.bind(a)),!s&&navigator.enumerateDevices&&(s=navigator.enumerateDevices.bind(navigator)),s?s(function(n){n.forEach(function(t){"audioinput"===t.kind&&(e._hasMicrophone=!0),"videoinput"===t.kind&&(e._hasCamera=!0)}),t(e)}):t(e)})},Object.defineProperty(e.prototype,"hasMicrophone",{get:function(){return this._hasMicrophone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCamera",{get:function(){return this._hasCamera},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAndroid",{get:function(){return this._isAndroid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBrowserSupported",{get:function(){return this._isBrowserSupported},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEdge",{get:function(){return this._isEdge},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isIos",{get:function(){return this._isIos},enumerable:!1,configurable:!0}),e}(),B=["debug","log","warn","error"],V=function(){function e(e,t){void 0===e&&(e="log"),void 0===t&&(t=!0),this.isEnabled=t,this.availableLogLevels=[],this._minLogLevel="log",this.setMinLogLevel(e)}return e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isEnabled&&this.availableLogLevels.includes(e)&&console[e].apply(console,function e(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(M(arguments[n]));return t}(t))},e.prototype.enableLogging=function(e){this.isEnabled=e},e.prototype.getMinLogLevel=function(){return this._minLogLevel},e.prototype.setMinLogLevel=function(e){var t=B.indexOf(e);this._minLogLevel=e,this.availableLogLevels=B.slice(t)},e}();function q(e,t){var n=Error(e);return n.name=t,n}var F,z=function(){function e(e,t,n,o,r,i){var s=this;void 0===i&&(i=new V),this.logger=i,this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this._closed=!1,this._outgoingQueue=[],this._microphoneMuteDelay=-1,this._offsetX=0,this._offsetY=0,e&&(this._viewport_element=e),window.SmRuntimeHostReceiveMessage=this.receiveMessage.bind(this),"function"==typeof window.SmRuntimeHostStyleViewportElement&&window.SmRuntimeHostStyleViewportElement(this._viewport_element),this._onClose=function(e){},this._onMessage=function(e){},this._onUserText=function(e){},this.sendVideoBounds(0,0),setTimeout(function(){s.sendVideoBounds(0,0)},3e3),this._features=new N,this.log("Local session created!")}return e.prototype.receiveMessage=function(e){var t,n,o=JSON.parse(e);this.log("message received 1: "+e),this._onMessage(o),"state"===o.name&&"scene"===o.category&&(null===(n=null===(t=o.body)||void 0===t?void 0:t.session)||void 0===n?void 0:n.state)==="idle"&&(this.log("Local session ending - conversationEnded"),this.close(!0,"conversationEnded"))},Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.log=function(e){this.logger.log("log",e)},e.prototype.sendVideoBounds=function(e,t){var n=this;setTimeout(function(){var e=n._viewport_element;if(e){var t=document.defaultView||window,o=parseInt(t.getComputedStyle(e).width,10),r=parseInt(t.getComputedStyle(e).height,10);for(n._offsetX=0,n._offsetY=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)n._offsetX+=e.offsetLeft-e.scrollLeft,n._offsetY+=e.offsetTop-e.scrollTop,e=e.offsetParent;if(document.documentElement){var i=document.documentElement.scrollLeft,s=document.documentElement.scrollTop;n._offsetX-=i,n._offsetY-=s}n.log("Updating bounds: x =  "+n._offsetX+" , y = "+n._offsetY+"', w = "+o+", h = "+r);var a=n._offsetY,c=n._offsetX,u=n._offsetY+r,l=n._offsetX+o;n.sendMessage({name:"videoBounds",body:{top:a,left:c,bottom:u,right:l},category:"local",kind:"event"})}},0)},e.prototype.hideVideo=function(){this.sendMessage({name:"videoBounds",body:{top:0,left:0,bottom:0,right:0},category:"local",kind:"event"})},e.prototype.sendRtcEvent=function(e,t){},e.prototype.connect=function(){return b(this,void 0,Promise,function(){var e,t,n,o=this;return $(this,function(r){switch(r.label){case 0:return e=new D,this.log("Local session connecting!"),this._closed=!1,[4,this._features.detectWebRTCFeatures()];case 1:return t=r.sent(),this._closed=!1,this._sessionId=void 0,this._isMicrophoneConnected=t.hasMicrophone,this._isCameraConnected=t.hasCamera,"number"==typeof window.local_websocket_port?(this._serverConnection=new WebSocket("ws://localhost:"+window.local_websocket_port),this.log("smsdk: websocket open"),this._serverConnection.onmessage=function(e){o.gotMessageFromServer(e)},this._serverConnection.onerror=function(t){e.isPending()&&e.reject(q("smsdk websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(t){window.SmRuntimeHostReceiveMessage=function(){},o.log("Local session connected!");for(var n=0;n<o._outgoingQueue.length;n++)o._serverConnection.send(JSON.stringify(o._outgoingQueue[n])),o.logger.log("log","SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: "+o._outgoingQueue[n]);o._outgoingQueue=[],e.isPending()&&e.resolve()},this._serverConnection.onclose=function(t){o.logger.log("log","smsdk: websocket closed: code("+t.code+"), reason("+t.reason+"), clean("+t.wasClean+")"),e.isRejected||o.close(!1,"normal")}):(this.log("local_websocket_port not found! Failed to create WebSocket"),e.isPending()&&e.reject(q("smsdk websocket failed","local_websocket_port not found"))),n={name:"startSession",body:{},category:"scene",kind:"request"},this.sendMessage(n),[2,e.promise]}})})},e.prototype.gotMessageFromServer=function(e){var t=JSON.parse(e.data),n=t.category,o=t.name,r=t.body;"webrtc"!==n?this._onMessage(t):"close"===o&&this.close(!1,r.reason),"state"===o&&"scene"===n&&null!==r.session&&void 0!==r.session&&"idle"===r.session.state&&(this.log("Local session ending due to server idle message"),this.close(!0,"conversationEnded"))},e.prototype.sendMessage=function(e){var t=JSON.stringify(e);this._serverConnection&&this._serverConnection.readyState===WebSocket.OPEN?(this._serverConnection.send(t),this.log("SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: "+t)):this._outgoingQueue.push(e)},e.prototype.sendUserText=function(e){this.logger.log("log","SmLocalSession.prototype.sendUserText, discarding text: "+e)},e.prototype.close=function(e,t){void 0===e&&(e=!0),void 0===t&&(t="normal"),!this._closed&&(this._closed=!0,this._onClose(t),this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this.hideVideo(),this._serverConnection&&(this.log("smsdk: closing server connection"),this._serverConnection.close(1e3,t)))},Object.defineProperty(e.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userMediaStream",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return this._isMicrophoneConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return this._isCameraConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){return"function"==typeof window.SmRuntimeHostIsMicrophoneMuted&&window.SmRuntimeHostIsMicrophoneMuted()},set:function(e){"function"==typeof window.SmRuntimeHostMuteMicrophone&&window.SmRuntimeHostMuteMicrophone(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this._offsetX},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this._offsetY},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){return this.isMicrophoneConnected&&!this.microphoneMuted},e.prototype.isCameraActive=function(){return this.isCameraConnected},e.prototype.setMediaDeviceActive=function(e){return e.microphone,e.camera,b(this,void 0,Promise,function(){return $(this,function(e){throw q("setMediaDeviceActive not supported on LocalSession","notSupported")})})},e}();(F=o||(o={}))[F.None=0]="None",F[F.Microphone=1]="Microphone",F[F.MicrophoneAndCamera=2]="MicrophoneAndCamera",F[F.Camera=3]="Camera";var W,j,K,Q,X=function(){function e(e,t,n,r,i,s,a,c,u){var l=this;void 0===u&&(u=new V),this.logger=u,this._connectPendingRemoteStream=null,this._outgoingQueue=[],this._controlOpen=!1,this._controlQueue=[],this._requestedUserMedia=o.None,this._requiredUserMedia=o.None,this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._microphoneMuteDelay=-1,this._changeUserMediaQueue=[],this._removeListeners=[],this._videoOptions={frameRate:10,width:640,height:480,facingMode:"user"},this._audioOptions={noiseSuppression:!1,autoGainControl:!1,channelCount:1,sampleRate:16e3,sampleSize:16,echoCancellation:!0},this._videoElement=e,this._serverUri=t,this._connectUserText=n||"",this._accessToken=r,this._audioOnly=i,this._audioOptions.echoCancellation=c,this._requiredUserMedia=a,this._requestedUserMedia=s,this._onClose=function(e){},this._onMessage=function(e){},this._onUserText=function(e){},this._sessionError=function(e){l.log("smsdk - session error: "+e)},this._features=new N}return Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.log=function(e,t){if(void 0===t&&(t="log"),this.loggingEnabled){var n=new Date().toISOString()+" "+e;this._shouldLogToServer&&this.logToServer(n),this.logger.log(t,n)}},e.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},e.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var t={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};console.log("send----",t),this.sendMessage(t)}},e.prototype.connect=function(e){return b(this,void 0,Promise,function(){var t,n,o=this;return $(this,function(r){return(t=new D,this._closed=!1,e&&(this._connectUserText=e),this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:")))?(this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,t,this.getUserMediaSuccess.bind(this)),[2,t.promise]):((n=new XMLHttpRequest).open("GET","/api/jwt"+window.location.search),n.onreadystatechange=function(e){return b(o,void 0,void 0,function(){var e;return $(this,function(o){return n.readyState===XMLHttpRequest.DONE&&(200===n.status?(this.log("JWT request returned: "+n.responseText),e=JSON.parse(n.responseText),this._serverUri=e.url,this._accessToken=e.jwt,this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,t,this.getUserMediaSuccess.bind(this))):(this.log("JWT Request failed, status: "+n.statusText),t.reject(q("Failed to acquire jwt at /api/jwt","noServer")))),[2]})})},n.send(),[2,t.promise])})})},e.prototype.webcamRequested=function(e,t){return!this._audioOnly&&[o.MicrophoneAndCamera,o.Camera].some(function(n){return[e,t].includes(n)})},e.prototype.micRequested=function(e,t){return[o.Microphone,o.MicrophoneAndCamera].some(function(n){return[e,t].includes(n)})},e.prototype.getMediaConstraints=function(e,t){var n=navigator.mediaDevices.getSupportedConstraints();return this.log("Browser supports media constraints: "+n,"debug"),{audio:!!this.micRequested(e,t)&&this._audioOptions,video:!!this.webcamRequested(e,t)&&this._videoOptions}},e.prototype.selectUserMedia=function(e,t,n,r){var i=this;if(e===o.None&&t===o.None){r(null,n);return}if(navigator.mediaDevices.getUserMedia){var s=this.getMediaConstraints(e,t);this.log("Best video constraints: "+s,"debug"),navigator.mediaDevices.getUserMedia(s).then(function(e){r(e,n)}).catch(function(s){t===e?(i.log("getUserMedia could not get required media, error given: "+s,"debug"),n.reject(i.MakeErrorForUserMedia(s))):t!==o.None?i.getUserMediaRequiredOnlyFallback(t,n,r):e===o.MicrophoneAndCamera?i.getUserMediaAudioOnlyFallback(n,r):r(null,n)})}else n.reject(q("Your browser does not support getUserMedia API","notSupported"))},e.prototype.getUserMediaRequiredOnlyFallback=function(e,t,n){var r=this;this.log("Retrying with required media only","debug");var i=this.getMediaConstraints(o.None,e);return this.log("Attempt constraints: "+i,"debug"),navigator.mediaDevices.getUserMedia(i).then(function(e){n(e,t)}).catch(function(e){r.log("getUserMedia could not get required media, error given: "+e,"debug"),t.reject(r.MakeErrorForUserMedia(e))})},e.prototype.getUserMediaAudioOnlyFallback=function(e,t){var n=this;this.log("Retrying with microphone only","debug");var o={video:!1,audio:this._audioOptions};return this.log("Attempt constraints: "+o,"debug"),navigator.mediaDevices.getUserMedia(o).then(function(n){t(n,e)}).catch(function(o){n.log("getUserMedia could not get microphone audio, error given: "+o,"debug"),t(null,e)})},e.prototype.MakeErrorForUserMedia=function(e){return q(e.message,"noUserMedia")},e.prototype.getUserMediaSuccess=function(e,t){var n=this;this.log("Got user media","debug"),this._localStream=e,this.microphoneMuted=!0,this.log("smsdk: connecting to: "+this._serverUri),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(e){try{n.gotMessageFromServer(e,t)}catch(o){n.log("smsdk: unexpected exception processing received message: "+o)}},this._serverConnection.onerror=function(e){t.isPending()&&t.reject(q("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(e){n.log("Websocket open")},this._serverConnection.onclose=function(e){n.log("smsdk: websocket closed: code("+e.code+"), reason("+e.reason+"), clean("+e.wasClean+")"),t.isRejected||n.close(!1,"normal",t)}},e.prototype.hasTurnServer=function(e){var t,n,o,r;if(!e)return!1;try{for(var i=E(e),s=i.next();!s.done;s=i.next()){var a=s.value;if(a&&a.urls)try{for(var c=(o=void 0,E(a.urls)),u=c.next();!u.done;u=c.next()){var l=u.value;if(0===l.indexOf("turn:"))return!0}}catch(d){o={error:d}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(o)throw o.error}}}}catch(h){t={error:h}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!1},e.prototype.gotMessageFromServer=function(e,t){var n,o,r=this,i=e.data;this.log("message received 2: "+i);var s=JSON.parse(i);if("conversationResult"==s.name){var a=s.body.output.context;localStorage.setItem("content",JSON.stringify(a)),localStorage.getItem("content")}var c=s.category,u=s.name,l=s.body;if("webrtc"!==c){null!==this._controlConnection&&"scene"===c&&(this._controlOpen&&this._serverConnection.readyState===WebSocket.OPEN?this._controlConnection.send(i):this._controlQueue.push(i)),this._onMessage(s);return}if("event"===s.kind){if("established"===u){var d={iceServers:[]};if(l.iceServers&&(d.iceServers=l.iceServers,this.hasTurnServer(l.iceServers)&&(this.log("Detected turn server, forcing relay mode"),d.iceTransportPolicy="relay")),this.log("selected ice servers: "+d.iceServers),l.settings&&"number"==typeof l.settings.microphoneMuteDelay&&(this._microphoneMuteDelay=l.settings.microphoneMuteDelay),this.log("microphone mute delay after persona speech: "+this._microphoneMuteDelay),this._shouldLogToServer=null!==(o=null===(n=l.settings)||void 0===n?void 0:n.logToServer)&&void 0!==o&&o,this._peerConnection=new RTCPeerConnection(d),this._peerConnection.onicecandidate=this.gotIceCandidate.bind(this),"ontrack"in this._peerConnection&&!this._features.isEdge?(this._peerConnection.ontrack=function(e){"video"!==e.track.kind&&"audio"!==e.track.kind||r._remoteStream&&(r._audioOnly||"video"!==e.track.kind)||r.onRemoteStream(e.streams[0])},this._videoElement.addEventListener("loadeddata",this.onVideoLoaded.bind(this)),this._removeListeners.push({target:this._videoElement,name:"loadeddata",callback:this.onVideoLoaded})):this._peerConnection.onaddstream=function(e){r.onRemoteStream(e.stream)},this._peerConnection.oniceconnectionstatechange=function(e){r.log("ICE connection state: "+r._peerConnection.iceConnectionState),"failed"===r._peerConnection.iceConnectionState&&(q("ice connection failed","mediaStreamFailed"),t&&t.isPending()&&(r._serverConnection.close(),r._controlConnection&&(r._controlConnection.readyState===WebSocket.OPEN||r._controlConnection.readyState===WebSocket.CONNECTING)&&r._controlConnection.close(),t.reject(q("ice connection failed","mediaStreamFailed"))))},this.log("adding local media stream if any","debug"),this._localStream){if(this._peerConnection.addTrack)try{this.log("adding local media stream by track","debug"),this._localStream.getTracks().forEach(function(e){r._peerConnection.addTrack(e,r._localStream)})}catch(h){this.logger.log("error",h)}else this._peerConnection.addStream(this._localStream),this.log("adding local media stream by stream","debug")}this._peerConnection.addTransceiver("audio",{direction:"sendrecv"}),this._peerConnection.addTransceiver("video",{direction:"sendrecv"}),this.createOffer(this._peerConnection,{voiceActivityDetection:!1}).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}else if("accepted"===u){this.log("accepted, session_id = "+l.sessionId),this._sessionId=l.sessionId,this._server=l.server,this._sceneId=l.sceneId;for(var p=0;p<this._outgoingQueue.length;p++)this._outgoingQueue[p].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[p]);this._outgoingQueue=[];var f=function(){r&&r.sendCameraRotation()};window.addEventListener("orientationchange",f),this._removeListeners.push({target:window,name:"orientationchange",callback:f}),this.sendCameraRotation();var g=(document.defaultView||window).getComputedStyle(this._videoElement),v=parseInt(""+g.width,10),m=parseInt(""+g.height,10);this.log("accepted, sending video width/height: "+v+" / "+m),this.sendVideoBounds(v,m),this.sendlogMessage(this._pendingLog),this._pendingLog=[],l.controlUrl&&(this._controlUrl=l.controlUrl,this._controlQueue=[],this._controlOpen=!1,this._controlConnection=new WebSocket(l.controlUrl+"?access_token="+this._accessToken),this._controlConnection.onmessage=function(e){var t=e.data;t&&r._serverConnection.readyState===WebSocket.OPEN&&r._serverConnection.send(t)},this._controlConnection.onerror=function(){r.close(!0,"controlFailed",t)},this._controlConnection.onopen=function(e){if(r.log("smsdk: control websocket open"),!r._controlOpen){r._controlOpen=!0;for(var t=0;t<r._controlQueue.length;t++)r.log("smsdk: control websocket now open, forwarding queued message: "+r._controlQueue[t]),r._controlConnection.send(r._controlQueue[t]);r._controlQueue=[]}},this._controlConnection.onclose=function(e){r.log("smsdk: control closed: code("+e.code+"), reason("+e.reason+"), clean("+e.wasClean+")"),r.close(!0,"controlDisconnected",t)})}else if("answer"===u){this.log("set remote description"),this.log(JSON.stringify(l));var y={sdp:l.sdp,type:"answer"};this.setRemoteDescription(this._peerConnection,y).then(function(){}).catch(this._sessionError.bind(this))}else if("connected"===u)this._remoteStream?(this.onConnected(),t&&t.resolve(l.sessionId)):(this.log("Connected but no remote media stream available"),this._connectPendingRemoteStream=function(){r.onConnected(),t&&t.resolve(l.sessionId)});else if("ice"===u){this.log("add ice candidate");var b=void 0;if(l.complete)this._features.isEdge&&(b=this._peerConnection.addIceCandidate(new RTCIceCandidate({candidate:"",sdpMid:"",sdpMLineIndex:0})));else{var $=new RTCIceCandidate({candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex});b=this._peerConnection.addIceCandidate($)}b&&b.catch(this._sessionError.bind(this))}else if("offer"===u){this._sessionId=l.sessionId;var y={sdp:l.sdp,type:"offer"};this.setRemoteDescription(this._peerConnection,y).then(function(){return r.createAnswer(r._peerConnection)}).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}else"userText"===u?(this.log("rtc - user text message received: "+l.userText),this._onUserText(l.userText)):"close"===u&&this.close(!1,l.reason,t)}},e.prototype.gotIceCandidate=function(e){e.candidate?(this.log("got local ice candidate"),this.sendRtcEvent("ice",{complete:!1,candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex})):(this.log("end ice candidate"),this.sendRtcEvent("ice",{complete:!0,candidate:"",sdpMid:"",sdpMLineIndex:0}))},e.prototype.createdDescription=function(e,t){var n=this;void 0===t&&(t="offer"),this.log("got description");var o={sdp:e.sdp,type:e.type};this.log(JSON.stringify({sdp:o})),this.setLocalDescription(this._peerConnection,e).then(function(){n.log("send sdp offer to server"),n.sendRtcEvent(t,{sdp:n._peerConnection.localDescription?n._peerConnection.localDescription.sdp:null,type:n._peerConnection.localDescription?n._peerConnection.localDescription.type:null,user_text:n._connectUserText,features:{videoStartedEvent:!0}})}).catch(this._sessionError.bind(this))},e.prototype.onRemoteStream=function(e){this.log("smsdk - got remote stream"),this._remoteStream=e,this.log("smsdk - ICE connection state: "+this._peerConnection.iceConnectionState),this._connectPendingRemoteStream&&(this._connectPendingRemoteStream(),this._connectPendingRemoteStream=null)},e.prototype.onConnected=function(){var e,t,n=this;this._videoElement.hidden=!1,this._videoElement.srcObject=this._remoteStream;var o=function(e){return b(n,void 0,void 0,function(){return $(this,function(t){return this._remoteStream&&this._remoteStream.addTrack(e.track),[2]})})};this._peerConnection.addEventListener("track",o),this._removeListeners.push({target:this._peerConnection,name:"track",callback:o}),this.log("video enabled"),this.sendUserCamera(),null===(e=this._onMicrophoneActive)||void 0===e||e.call(this.isMicrophoneActive()),null===(t=this._onCameraActive)||void 0===t||t.call(this.isCameraActive())},e.prototype.onVideoLoaded=function(e){var t=this;this.log("video has loaded");var n=function(){t.log("video has started playing"),t.sendRtcEvent("videoStarted",{}),t.microphoneMuted=!1};if(!this._videoElement.muted){n();return}var o=function(){n(),t._videoElement.removeEventListener("volumechange",o)};this._videoElement.addEventListener("volumechange",o,!1)},e.prototype.sendRtcEvent=function(e,t){if(null!==this._serverConnection){this._sessionId&&(t.sessionId=this._sessionId);var n={category:"webrtc",kind:"event",name:e,body:t};this.log("sendRtcEvent, payload = "+JSON.stringify(n)),this._sessionId||"offer"===e?this.sendMessage(n):this._outgoingQueue.push(n)}},e.prototype.sendVideoBounds=function(e,t){this.sendRtcEvent("videoBounds",{width:e,height:t})},e.prototype.sendUserCamera=function(e){var t={active:this.isCameraActive()};void 0!==e&&(t.rotation=e),this.sendRtcEvent("userCamera",t)},e.prototype.sendCameraRotation=function(){if(this._features.isIos){var e=window.orientation;this.log("send updated camera rotation, device orientation: "+e);var t=0;0===e?t=90:90===e?t=180:180===e?t=270:-90===e&&(t=0),this.sendUserCamera(t)}},e.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("smsdk - not ready, discarding message: "+e))},e.prototype.sendUserText=function(e){this.sendRtcEvent("userText",{userText:e})},e.prototype.hasCamera=function(e){return e===o.Camera||e===o.MicrophoneAndCamera},e.prototype.hasMicrophone=function(e){return e===o.Microphone||e===o.MicrophoneAndCamera},e.prototype.makeUserMedia=function(e,t){return e&&t?o.MicrophoneAndCamera:e?o.Microphone:t?o.Camera:(0,o.None)},e.prototype.findSenderTrackByKind=function(e){if(!this._peerConnection)return null;var t,n,o,r=this._peerConnection.getSenders();try{for(var i=E(r),s=i.next();!s.done;s=i.next()){var a=s.value;if(a.track&&(null===(o=a.track)||void 0===o?void 0:o.kind)===e)return a.track}}catch(c){t={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},e.prototype.findSenderByKind=function(e){if(!this._peerConnection)return null;try{for(var t,n,o,r,i,s,a=E(this._peerConnection.getTransceivers()),c=a.next();!c.done;c=a.next()){var u=c.value;if("sendrecv"===u.direction&&(null===(s=null===(i=u.receiver)||void 0===i?void 0:i.track)||void 0===s?void 0:s.kind)===e)return u.sender}}catch(l){t={error:l}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}try{for(var d=E(this._peerConnection.getSenders()),h=d.next();!h.done;h=d.next()){var p=h.value;if(null===p.track||p.track.kind===e)return p}}catch(f){o={error:f}}finally{try{h&&!h.done&&(r=d.return)&&r.call(d)}finally{if(o)throw o.error}}return null},e.prototype.processChangeUserMediaQueue=function(){var e,t,n,o;return b(this,void 0,void 0,function(){var r,i,s,a;return $(this,function(c){switch(c.label){case 0:if(!(r=this._changeUserMediaQueue.length>0?this._changeUserMediaQueue[0]:void 0))return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),i=this.isMicrophoneActive(),s=this.isCameraActive(),[4,this.changeUserMediaInternal(this.makeUserMedia(null!==(e=r.microphone)&&void 0!==e?e:i,null!==(t=r.camera)&&void 0!==t?t:s)),];case 2:return c.sent(),void 0!==r.microphone&&r.microphone!==i&&(null===(n=this._onMicrophoneActive)||void 0===n||n.call(this.isMicrophoneActive())),void 0!==r.camera&&r.camera!==s&&(null===(o=this._onCameraActive)||void 0===o||o.call(this.isCameraActive())),r.deferred.resolve(),[3,4];case 3:return a=c.sent(),r.deferred.reject(a),[3,4];case 4:this._changeUserMediaQueue.shift(),c.label=5;case 5:if(r)return[3,0];c.label=6;case 6:return[2]}})})},e.prototype.changeUserMediaInternal=function(e){return b(this,void 0,Promise,function(){var t,n,o,r,i,s,a,c=this;return $(this,function(u){switch(u.label){case 0:if(t=this.findSenderTrackByKind("audio"),n=this.findSenderTrackByKind("video"),o=this.hasMicrophone(e)&&(!t||"ended"===t.readyState),r=this.hasCamera(e)&&(!n||"ended"===n.readyState),i=null,!(o||r))return[3,2];return s=this.makeUserMedia(o,r),a=new D,this.selectUserMedia(s,s,a,function(e,t){return b(c,void 0,void 0,function(){return $(this,function(n){return i=e,t.resolve(),[2]})})}),[4,a.promise];case 1:u.sent(),this._localStream||(this._localStream=new MediaStream),u.label=2;case 2:return[4,this.updateSenderTrack("audio",this.hasMicrophone(e),i),];case 3:return u.sent(),[4,this.updateSenderTrack("video",this.hasCamera(e),i),];case 4:return u.sent(),this.sendUserCamera(),[2]}})})},e.prototype.updateSenderTrack=function(e,t,n){var o,r;return b(this,void 0,Promise,function(){var i,s,a,c;return $(this,function(u){switch(u.label){case 0:if(s=null==(i=this.findSenderByKind(e))?void 0:i.track,!(i&&(!s||t!==s.enabled)))return[3,7];if(this.log("new user "+e+" active state = "+t),!t)return[3,6];u.label=1;case 1:if(u.trys.push([1,4,,5]),s&&(null===(o=this._localStream)||void 0===o||o.removeTrack(s)),!n||!(a=this.getTrackByKind(n,e))||(null===(r=this._localStream)||void 0===r||r.addTrack(a),!(i.track!==a)))return[3,3];return this.log("replacing user "+e+" track"),[4,i.replaceTrack(a)];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:throw c=u.sent(),this.log("failed to get user "+e+" track, error: "+c),q("failed to get user "+e+": "+c,"failedUpgrade");case 5:return[3,7];case 6:s&&(s.enabled=!1,s.stop()),u.label=7;case 7:return[2]}})})},e.prototype.getTrackByKind=function(e,t){var n,o;if(e)try{for(var r=E(e.getTracks()),i=r.next();!i.done;i=r.next()){var s=i.value;if(s.kind===t)return s}}catch(a){n={error:a}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}},e.prototype.isSenderTrackEnabled=function(e){var t=this.findSenderTrackByKind(e);return Boolean(null==t?void 0:t.enabled)},e.prototype.isMicrophoneActive=function(){return this.isSenderTrackEnabled("audio")},e.prototype.isCameraActive=function(){return this.isSenderTrackEnabled("video")},e.prototype.setMediaDeviceActive=function(e){var t=e.microphone,n=e.camera;return b(this,void 0,Promise,function(){var e;return $(this,function(o){return e=new D,this._changeUserMediaQueue.push({microphone:t,camera:n,deferred:e}),1===this._changeUserMediaQueue.length&&this.processChangeUserMediaQueue(),[2,e.promise]})})},e.prototype.close=function(e,t,n){var o,r;if(void 0===e&&(e=!0),void 0===t&&(t="normal"),!this._closed){if(this._closed=!0,this._peerConnection)try{this._peerConnection.close()}catch(i){this.logger.log("error",i)}if(this._localStream)try{var s=this._localStream.getTracks();for(var a in s)s[a].stop()}catch(c){this.logger.log("error",c)}e&&this.sendRtcEvent("close",{reason:"normal"}),n&&(n.isResolved()?this._onClose(t):n.reject(q("websocket closed: "+t,t))),this._serverConnection&&(this.log("smsdk: closing server connection"),this._serverConnection.close()),this._controlConnection&&this._controlConnection.close();try{for(var u=E(this._removeListeners),l=u.next();!l.done;l=u.next()){var d=l.value;d.target.removeEventListener(d.name,d.callback)}}catch(h){o={error:h}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(o)throw o.error}}}},e.prototype.createOffer=function(e,t){return e.createOffer(t)},e.prototype.setRemoteDescription=function(e,t){return e.setRemoteDescription(t)},e.prototype.setLocalDescription=function(e,t){return e.setLocalDescription(t)},e.prototype.createAnswer=function(e){return e.createAnswer()},Object.defineProperty(e.prototype,"peerConnection",{get:function(){return this._peerConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"server",{get:function(){return this._server},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sceneId",{get:function(){return this._sceneId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return!!this.findSenderTrackByKind("audio")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return!!this.findSenderTrackByKind("video")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userMediaStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getAudioTracks();return!e||e.length<1||!e[0].enabled},set:function(e){if(this._localStream){var t,n,o=this._localStream.getAudioTracks();if(o&&!(o.length<1)){var r=this.findSenderByKind("audio");if((null===(t=null==r?void 0:r.track)||void 0===t?void 0:t.readyState)==="live"&&r.track===o[0]){var i=!e;o[0].enabled=i,console.log("microphone muted active notification: "+i),null===(n=this._onMicrophoneActive)||void 0===n||n.call(i)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webcamMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getVideoTracks();return!e||e.length<1||!e[0].enabled},set:function(e){if(this._localStream){var t,n,o=this._localStream.getVideoTracks();if(o&&!(o.length<1)){var r=this.findSenderByKind("video");if((null===(t=null==r?void 0:r.track)||void 0===t?void 0:t.readyState)==="live"&&r.track===o[0]){var i=!e;o[0].enabled=i,null===(n=this._onCameraActive)||void 0===n||n.call(i)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneActiveCallbacks",{set:function(e){this._onMicrophoneActive=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraActiveCallbacks",{set:function(e){this._onCameraActive=e},enumerable:!1,configurable:!0}),e}(),H=function(){function e(e,t,n){var o=this;void 0===n&&(n=new V),this.logger=n,this._outgoingQueue=[],this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._serverUri=e,this._accessToken=t,this._onClose=function(e){},this._onMessage=function(e){},this._sessionError=function(e){o.logger.log("error","smsdk - session error: "+e)},this._features=new N}return Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.log=function(e){this.loggingEnabled&&(this._shouldLogToServer?this.logToServer(e):this.logger.log("log",e))},e.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},e.prototype.sendlogMessage=function(e){this._sessionId&&e&&e.length>0&&this.sendMessage({category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}})},e.prototype.connect=function(){return b(this,void 0,Promise,function(){var e;return $(this,function(t){return e=new D,this._closed=!1,this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))&&this.connectByWebSocket(e),[2,e.promise]})})},e.prototype.connectByWebSocket=function(e){var t=this;this.log("smsdk: connecting to: "+this._serverUri),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(n){t.gotMessageFromServer(n,e)},this._serverConnection.onerror=function(t){e.isPending()&&e.reject(q("smsdk websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(n){t.log("smsdk: websocket open"),e.resolve()},this._serverConnection.onclose=function(n){t.log("smsdk: websocket closed: code("+n.code+"), reason("+n.reason+"), clean("+n.wasClean+")"),e.isRejected||t.close(!1,"normal",e)}},e.prototype.gotMessageFromServer=function(e,t){var n=e.data;this.log("message received 3: "+n);var o=JSON.parse(n),r=o.category,i=o.name,s=o.body;if("webrtc"!==r){this._onMessage(o);return}if("event"===o.kind){if("accepted"===i){this.log("accepted, session_id = "+s.sessionId),this._sessionId=s.sessionId;for(var a=0;a<this._outgoingQueue.length;a++)this._outgoingQueue[a].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[a]);this._outgoingQueue=[],this.sendlogMessage(this._pendingLog),this._pendingLog=[]}else"close"===i&&this.close(!1,s.reason,t)}},e.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("smsdk - not ready, discarding message: "+e))},e.prototype.close=function(e,t,n){void 0===e&&(e=!0),void 0===t&&(t="normal"),!this._closed&&(this._closed=!0,n&&(n.isResolved()?this._onClose(t):n.reject(q("websocket closed: "+t,t))),this._serverConnection&&(this.log("smsdk: closing server connection"),this._serverConnection.close()))},Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),e.prototype.sendRtcEvent=function(e,t){},e.prototype.sendVideoBounds=function(e,t){},e.prototype.sendUserText=function(e){this.logger.log("error","WebSocketSession discarding text: "+e)},Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){return!1},e.prototype.isCameraActive=function(){return!1},e.prototype.setMediaDeviceActive=function(e){return e.microphone,e.camera,b(this,void 0,Promise,function(){return $(this,function(e){throw q("setMediaDeviceActive not supported on WebSocketSession","notSupported")})})},e}();(W=r||(r={})).Scene="scene",(j=i||(i={})).Response="response",j.Request="request",(K=s||(s={})).Idle="idle",K.Animating="animating",K.Speaking="speaking",(Q=a||(a={})).UI_CONTENT_AWARENESS="UI_CONTENT_AWARENESS",Q.UI_SDK_CAMERA_CONTROL="UI_SDK_CAMERA_CONTROL";var Y,G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.requestName="",t.status=0,t}return!function e(t,n){if("function"!=typeof n&&null!==n)throw TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}p(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return"Scene response failed, status: "+this.status},enumerable:!1,configurable:!0}),t}(Error),J=[],Z="ResizeObserver loop completed with undelivered notifications.",ee=function(){var e;"function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:Z}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=Z),window.dispatchEvent(e)};(Y=c||(c={})).BORDER_BOX="border-box",Y.CONTENT_BOX="content-box",Y.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box";var et,en=function(e){return Object.freeze(e)},eo=function e(t,n){this.inlineSize=t,this.blockSize=n,en(this)},er=function(){function e(e,t,n,o){return this.x=e,this.y=t,this.width=n,this.height=o,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,en(this)}return e.prototype.toJSON=function(){var e,t=this.x,n=this.y,o=this.top,r=this.right,i=this.bottom,s=this.left;return{x:t,y:n,top:o,right:r,bottom:i,left:s,width:this.width,height:this.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),ei=function(e){return e instanceof SVGElement&&"getBBox"in e},es=function(e){if(ei(e)){var t=e.getBBox(),n=t.width,o=t.height;return!n&&!o}var r=e,i=r.offsetWidth,s=r.offsetHeight;return!(i||s||e.getClientRects().length)},ea=function(e){if(e instanceof Element)return!0;var t,n,o=null===(n=null===(t=e)||void 0===t?void 0:t.ownerDocument)||void 0===n?void 0:n.defaultView;return!!(o&&e instanceof o.Element)},ec=function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},eu="undefined"!=typeof window?window:{},el=new WeakMap,ed=/auto|scroll/,eh=/^tb|vertical/,ep=/msie|trident/i.test(eu.navigator&&eu.navigator.userAgent),ef=function(e){return parseFloat(e||"0")},eg=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=!1),new eo((n?t:e)||0,(n?e:t)||0)},ev=en({devicePixelContentBoxSize:eg(),borderBoxSize:eg(),contentBoxSize:eg(),contentRect:new er(0,0,0,0)}),em=function(e,t){if(void 0===t&&(t=!1),el.has(e)&&!t)return el.get(e);if(es(e))return el.set(e,ev),ev;var n=getComputedStyle(e),o=ei(e)&&e.ownerSVGElement&&e.getBBox(),r=!ep&&"border-box"===n.boxSizing,i=eh.test(n.writingMode||""),s=!o&&ed.test(n.overflowY||""),a=!o&&ed.test(n.overflowX||""),c=o?0:ef(n.paddingTop),u=o?0:ef(n.paddingRight),l=o?0:ef(n.paddingBottom),d=o?0:ef(n.paddingLeft),h=o?0:ef(n.borderTopWidth),p=o?0:ef(n.borderRightWidth),f=o?0:ef(n.borderBottomWidth),g=o?0:ef(n.borderLeftWidth),v=d+u,m=c+l,y=g+p,b=h+f,$=a?e.offsetHeight-b-e.clientHeight:0,C=s?e.offsetWidth-y-e.clientWidth:0,S=o?o.width:ef(n.width)-(r?v+y:0)-C,E=o?o.height:ef(n.height)-(r?m+b:0)-$,M=en({devicePixelContentBoxSize:eg(Math.round(S*devicePixelRatio),Math.round(E*devicePixelRatio),i),borderBoxSize:eg(S+v+C+y,E+m+$+b,i),contentBoxSize:eg(S,E,i),contentRect:new er(d,c,S,E)});return el.set(e,M),M},e8=function(e,t,n){var o=em(e,n),r=o.borderBoxSize,i=o.contentBoxSize,s=o.devicePixelContentBoxSize;switch(t){case c.DEVICE_PIXEL_CONTENT_BOX:return s;case c.BORDER_BOX:return r;default:return i}},ey=function e(t){var n=em(t);this.target=t,this.contentRect=n.contentRect,this.borderBoxSize=en([n.borderBoxSize]),this.contentBoxSize=en([n.contentBoxSize]),this.devicePixelContentBoxSize=en([n.devicePixelContentBoxSize,])},eb=function(e){if(es(e))return 1/0;for(var t=0,n=e.parentNode;n;)t+=1,n=n.parentNode;return t},e$=function(){var e=1/0,t=[];J.forEach(function n(o){if(0!==o.activeTargets.length){var r=[];o.activeTargets.forEach(function t(n){var o=new ey(n.target),i=eb(n.target);r.push(o),n.lastReportedSize=e8(n.target,n.observedBox),i<e&&(e=i)}),t.push(function e(){o.callback.call(o.observer,r,o.observer)}),o.activeTargets.splice(0,o.activeTargets.length)}});for(var n=0,o=t;n<o.length;n++)(0,o[n])();return e},eC=function(e){J.forEach(function t(n){n.activeTargets.splice(0,n.activeTargets.length),n.skippedTargets.splice(0,n.skippedTargets.length),n.observationTargets.forEach(function t(o){o.isActive()&&(eb(o.target)>e?n.activeTargets.push(o):n.skippedTargets.push(o))})})},eS=function(){var e=0;for(eC(e);J.some(function(e){return e.activeTargets.length>0});)e=e$(),eC(e);return J.some(function(e){return e.skippedTargets.length>0})&&ee(),e>0},eE=[],eM=function(e){if(!u){var t=0,n=document.createTextNode("");new MutationObserver(function(){return eE.splice(0).forEach(function(e){return e()})}).observe(n,{characterData:!0}),u=function(){n.textContent=""+(t?t--:t++)}}eE.push(e),u()},ew=function(e){eM(function t(){requestAnimationFrame(e)})},eT=0,ek={attributes:!0,characterData:!0,childList:!0,subtree:!0},eR=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus",],e_=function(e){return void 0===e&&(e=0),Date.now()+e},eA=!1,eI=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!eA){eA=!0;var n=e_(e);ew(function(){var o=!1;try{o=eS()}finally{if(eA=!1,e=n-e_(),!eT)return;o?t.run(1e3):e>0?t.run(e):t.start()}})}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,ek)};document.body?t():eu.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),eR.forEach(function(t){return eu.addEventListener(t,e.listener,!0)}))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),eR.forEach(function(t){return eu.removeEventListener(t,e.listener,!0)}),this.stopped=!0)},e}()),eO=function(e){!eT&&e>0&&eI.start(),(eT+=e)||eI.stop()},eP=function(){function e(e,t){this.target=e,this.observedBox=t||c.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=e8(this.target,this.observedBox,!0);return!ei(e=this.target)&&!ec(e)&&"inline"===getComputedStyle(e).display&&(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),ex=function e(t,n){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=t,this.callback=n},eU=new WeakMap,eL=function(e,t){for(var n=0;n<e.length;n+=1)if(e[n].target===t)return n;return -1},eD=function(){function e(){}return e.connect=function(e,t){var n=new ex(e,t);eU.set(e,n)},e.observe=function(e,t,n){var o=eU.get(e),r=0===o.observationTargets.length;0>eL(o.observationTargets,t)&&(r&&J.push(o),o.observationTargets.push(new eP(t,n&&n.box)),eO(1),eI.schedule())},e.unobserve=function(e,t){var n=eU.get(e),o=eL(n.observationTargets,t),r=1===n.observationTargets.length;o>=0&&(r&&J.splice(J.indexOf(n),1),n.observationTargets.splice(o,1),eO(-1))},e.disconnect=function(e){var t=this,n=eU.get(e);n.observationTargets.slice().forEach(function(n){return t.unobserve(e,n.target)}),n.activeTargets.splice(0,n.activeTargets.length)},e}(),eN=function(){function e(e){if(0===arguments.length)throw TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");eD.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!ea(e))throw TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");eD.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!ea(e))throw TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");eD.unobserve(this,e)},e.prototype.disconnect=function(){eD.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}(),eB=function(e,t){void 0===t&&(t=500);var n=-1;return function(){n&&clearTimeout(n),n=setTimeout(function(){return e()},t)}},eV=function(){function e(e,t,n){var o=this;void 0===t&&(t=300),void 0===n&&(n=new V),this.scene=e,this.debounceTime=t,this.logger=n,this.VIDEO_FRAME_STR="data-sm-video",this.VIDEO_FRAME_STR_BRACKETED="["+this.VIDEO_FRAME_STR+"]",this.CONTENT_STR="data-sm-content",this.CONTENT_STR_BRACKETED="["+this.CONTENT_STR+"]",this.CUE_ATTRIBUTES=[this.VIDEO_FRAME_STR,this.CONTENT_STR],this.CUE_ATTRIBUTES_BRACKETED=[this.VIDEO_FRAME_STR_BRACKETED,this.CONTENT_STR_BRACKETED,].join(),this.RESIZE_OBSERVER_BOX_OPTIONS="border-box",this.callMeasure=!1,this.contentCollection={},this.videoFrame=null,this.debouncedMeasure=eB(function(){return o.measureInternal()},t),this.resizeObserver=new eN(function(){return o.measureDebounced()}),this.getInitialElements(),this.mutationObserver=new MutationObserver(function(e){return o.mutationCallback(e)}),this.setupEventListeners(),this.observeMutations(),this.measureInternal()}return e.prototype.isLoggingEnabled=function(){return this.logger.isEnabled},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setupEventListeners=function(){var e=this;window.addEventListener("resize",function(){return e.measureDebounced()})},e.prototype.getInitialElements=function(){var e=this,t=document.querySelector(this.VIDEO_FRAME_STR_BRACKETED),n=document.querySelectorAll(this.CONTENT_STR_BRACKETED);this.trackVideoElement(t),Array.from(n).map(function(t){return e.trackContentElement(t)})},e.prototype.observeMutations=function(){var e=document.documentElement||document.body;this.mutationObserver.observe(e,{attributeFilter:this.CUE_ATTRIBUTES,attributeOldValue:!0,childList:!0,subtree:!0})},e.prototype.disconnect=function(){var e=this;this.mutationObserver.disconnect(),this.resizeObserver.disconnect(),window.removeEventListener("resize",function(){return e.measureDebounced()}),this.scene.contentAwareness=void 0},e.prototype.reconnect=function(){this.scene.contentAwareness=this,this.observeMutations(),this.setupEventListeners(),this.measure()},e.prototype.measure=function(){this.measureInternal()},e.prototype.measureDebounced=function(){this.debouncedMeasure()},e.prototype.measureInternal=function(){if(!this.scene.isConnected()){this.logger.log("error","ContentAwareness: Scene does not exist or is not connected yet");return}var e=this.measureWindow(),t=this.measureVideoFrame(),n=this.measureContent();if(e&&t&&n){var o=this.buildUpdateContentAwarenessRequest(e.innerWidth,e.innerHeight,t,n);this.scene.sendRequest("updateContentAwareness",o)}},e.prototype.measureVideoFrame=function(){if(!this.videoFrame)return this.logger.log("error","ContentAwareness: Unable to find a video element"),null;var e=this.videoFrame.getBoundingClientRect();return this.invalidDimensions(e)?(this.logger.log("warn","ContentAwareness: Video has a zero width and height"),null):{x1:Math.round(e.left),x2:Math.round(e.right),y1:Math.round(e.top),y2:Math.round(e.bottom)}},e.prototype.measureContent=function(){var e=this,t=[];return Object.keys(this.contentCollection).map(function(n){var o=e.contentCollection[n].getBoundingClientRect();if(e.invalidDimensions(o)&&e.logger.log("warn","ContentAwareness: Element '"+n+"' has a zero width and height"),e.invalidContent(o)){e.logger.log("warn","ContentAwareness: Element '"+n+"' is not being tracked"),delete e.contentCollection[n];return}t.push({id:n,x1:Math.round(o.left),x2:Math.round(o.right),y1:Math.round(o.top),y2:Math.round(o.bottom)})}),t},e.prototype.invalidDimensions=function(e){return 0===e.width&&0===e.height},e.prototype.invalidContent=function(e){return 0===e.top&&0===e.bottom&&0===e.right&&0===e.left},e.prototype.measureWindow=function(){return{innerHeight:Math.round(window.innerHeight),innerWidth:Math.round(window.innerWidth)}},e.prototype.buildUpdateContentAwarenessRequest=function(e,t,n,o){return{viewWidth:e,viewHeight:t,videoFrame:n,content:o}},e.prototype.trackVideoElement=function(e){e&&(this.videoFrame&&(this.logger.log("warn","ContentAwareness: Already observing a video element, switching to new video element"),this.untrackVideoElement(this.videoFrame)),this.videoFrame=e,this.resizeObserver.observe(this.videoFrame,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}))},e.prototype.trackContentElement=function(e){var t=e.getAttribute(this.CONTENT_STR);return!!t&&(this.contentCollection[t]=e,this.resizeObserver.observe(e,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}),!0)},e.prototype.untrackContentElement=function(e){var t=e.getAttribute(this.CONTENT_STR);e===this.contentCollection[t]&&(delete this.contentCollection[t],this.resizeObserver.unobserve(e))},e.prototype.untrackVideoElement=function(e){this.videoFrame=null,this.resizeObserver.unobserve(e)},e.prototype.mutationCallback=function(e){var t=this,n=!1;this.callMeasure=!1;for(var o=0;o<e.length;++o)switch(e[o].type){case"childList":if(e[o].target.nodeType!==Node.ELEMENT_NODE)break;this.untrackRemovedNodeWithCUE(e[o].removedNodes),this.trackAddedNodeWithCUE(e[o].addedNodes);for(var r=0;r<e[o].addedNodes.length;r++)try{var i=e[o].addedNodes[r];if(!i.hasAttribute)continue;var s="IMG"===i.tagName,a=!!i.querySelector("img");if(n=s||a)break}catch(c){this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[o].addedNodes[r])}break;case"attributes":if(e[o].target.nodeType!==Node.ELEMENT_NODE)break;try{var i=e[o].target,u=e[o].attributeName;if(u===this.VIDEO_FRAME_STR)i.hasAttribute(u)?(this.trackVideoElement(i),this.callMeasure=!0):this.videoFrame&&this.untrackVideoElement(i);else if(u===this.CONTENT_STR){var l=i.getAttribute(u),d=e[o].oldValue;d&&(this.resizeObserver.unobserve(this.contentCollection[d]),delete this.contentCollection[d]),l&&(this.contentCollection[l]=i,this.resizeObserver.observe(i,{box:this.RESIZE_OBSERVER_BOX_OPTIONS})),this.callMeasure=!0}}catch(h){this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[o].target)}}this.callMeasure&&(n?Promise.all(Array.from(document.images).filter(function(e){return!e.complete}).map(function(e){return new Promise(function(t){e.onload=t,e.onerror=t})})).then(function(){t.measureDebounced()}):this.measureDebounced())},e.prototype.trackAddedNodeWithCUE=function(e){var t=this;e.forEach(function(e){try{var n=e;if(!n.hasAttribute)return;n.hasAttribute(t.VIDEO_FRAME_STR)?(t.trackVideoElement(n),t.callMeasure=!0):n.hasAttribute(t.CONTENT_STR)&&(t.callMeasure=t.trackContentElement(n)),null!==n.querySelector(t.CUE_ATTRIBUTES_BRACKETED)&&n.querySelectorAll(t.CUE_ATTRIBUTES_BRACKETED).forEach(function(e){e.hasAttribute(t.VIDEO_FRAME_STR)?(t.trackVideoElement(e),t.callMeasure=!0):e.hasAttribute(t.CONTENT_STR)&&(t.callMeasure=t.trackContentElement(e))})}catch(o){t.logger.log("warn","ContentAwareness: Failed to track non-element node",e)}})},e.prototype.untrackRemovedNodeWithCUE=function(e){var t=this;e.forEach(function(e){try{var n=e;if(!n.hasAttribute)return;n.hasAttribute(t.VIDEO_FRAME_STR)?t.untrackVideoElement(n):n.hasAttribute(t.CONTENT_STR)&&(t.untrackContentElement(n),t.callMeasure=!0),null!==n.querySelector(t.CUE_ATTRIBUTES_BRACKETED)&&n.querySelectorAll(t.CUE_ATTRIBUTES_BRACKETED).forEach(function(e){e.hasAttribute(t.VIDEO_FRAME_STR)?t.untrackVideoElement(e):e.hasAttribute(t.CONTENT_STR)&&(t.untrackContentElement(e),t.callMeasure=!0)})}catch(o){t.logger.log("warn","ContentAwareness: Failed to track non-element node",e)}})},e}(),eq=function(e,t){return(void 0===t&&(t=o.None),e)?e.camera&&e.microphone?o.MicrophoneAndCamera:e.camera?o.Camera:e.microphone?o.Microphone:(0,o.None):t},eF=function(){function e(e,t,n,r,i,s){var a=this;if(void 0===t&&(t=!1),void 0===n&&(n=o.MicrophoneAndCamera),void 0===r&&(r=o.Microphone),this._onConversationResultEvents={},this._onSpeechMarkerEvents={},this._session=void 0,this._isWebSocketOnly=!1,this._transactionId=0,this._pendingResponses={},this._microphoneUnmuteTimer=void 0,this._echoCancellationEnabled=!0,this._serverControlledCameras=!1,this._loggingConfig={session:{},contentAwareness:{}},this._onMicrophoneActive=new d,this._onCameraActive=new d,this.visibilityChange=function(){var e="visible"===document.visibilityState;console.log("rtc - new ui visibility: "+e),setTimeout(function(){a._session&&a._session.sendRtcEvent("ui",{visible:e})},500)},this.isSceneOptions(e)){var c=e;this._videoElement=c.videoElement,this._apiKey=c.apiKey,this._audioOnly=c.audioOnly||t,this._requestedUserMedia=eq(c.requestedMediaDevices,n),this._requiredUserMedia=eq(c.requiredMediaDevices,r),this.contentAwarenessDebounceTime=c.contentAwarenessDebounceTime,this._loggingConfig=f(f({},this._loggingConfig),c.loggingConfig||{})}else this._videoElement=e,this._audioOnly=t,this._requestedUserMedia=n,this._requiredUserMedia=r,this.contentAwarenessDebounceTime=i,this._loggingConfig=f(f({},this._loggingConfig),s);this._onStateEvent=new d,this._onStateEvent.addListener(function(e,t){a._onState&&a._onState(e,t)}),this._onRecognizeResultsEvent=new d,this._onRecognizeResultsEvent.addListener(function(e,t,n,o){a._onRecognizeResults&&a._onRecognizeResults(e,t,n,o)}),this._onDisconnectedEvent=new d,this._onDisconnectedEvent.addListener(function(e,t,n){a._onDisconnected&&a._onDisconnected(e,t,n)}),this._onUserTextEvent=new d,this._onUserTextEvent.addListener(function(e,t){a._onUserText&&a._onUserText(e,t)}),this._onDemoModeEvent=new d,this._underRuntimeHost=Boolean(window.SmIsUnderRuntimeHost);var u=new Uint32Array(3);window.crypto.getRandomValues(u),this._sceneId=u.toString().replace(/,/g,"-")}return e.prototype.isSceneOptions=function(e){var t,n=!!(null===(t=e)||void 0===t?void 0:t.tagName);return!!e&&!n},e.prototype.connectionValid=function(){return!!this._underRuntimeHost||!!this._session&&!!this._session.serverConnection},e.prototype.isConnected=function(){return!!this.connectionValid()&&!!this._session&&!!this._session.serverConnection&&this._session.serverConnection.readyState===this._session.serverConnection.OPEN},e.prototype.keepAlive=function(){this._session&&null!==this._session.peerConnection&&this._session.sendRtcEvent("keepAlive",{})},e.prototype.disconnect=function(){var e,t;null===(e=this.contentAwareness)||void 0===e||e.disconnect(),null===(t=this._session)||void 0===t||t.close(!0),this._session=void 0},e.prototype.connect=function(e,t,n,o){return b(this,void 0,void 0,function(){var r,i,s,a,c,u,l=this;return $(this,function(d){switch(d.label){case 0:if(r=new V(this._loggingConfig.session.minLogLevel,this._loggingConfig.session.enabled),s=(i=this.connectArgsToConfig(e,t,n,o)).tokenServerUri||i.tokenServerAccessToken,this._apiKey&&s&&r.log("warn","You are trying to connect via an API key and a token server. Please use one or the other"),!(this._apiKey&&!s))return[3,5];d.label=1;case 1:return d.trys.push([1,4,,5]),[4,this.fetchAuthConfig(this._apiKey)];case 2:return[4,(a=d.sent()).json()];case 3:return c=d.sent(),i.tokenServerUri=c.url,i.tokenServerAccessToken=c.jwt,[3,5];case 4:throw u=d.sent(),q("Invalid API key","serverConnectionFailed");case 5:if(!i.tokenServerUri||!i.tokenServerAccessToken)throw q("Please authenticate via an API key or with a serverUri and accessToken","serverConnectionFailed");return this._underRuntimeHost?(console.log("Detected RuntimeHost, creating local session"),this._session=new z(this._videoElement,i.tokenServerUri,i.userText,i.tokenServerAccessToken,this._audioOnly,r)):this._isWebSocketOnly?(console.log("Creating WebSocket session only"),this._session=new H(i.tokenServerUri,i.tokenServerAccessToken,r)):this._session=new X(this._videoElement,i.tokenServerUri,i.userText,i.tokenServerAccessToken,this._audioOnly,this._requestedUserMedia,this._requiredUserMedia,this._echoCancellationEnabled,r),this._session.onMessage=this.onMessage.bind(this),this._session.onClose=this.sessionClosed.bind(this),this._session.onUserText=this.rtcUserText.bind(this),"microphoneActiveCallbacks"in this._session&&(this._session.microphoneActiveCallbacks=this._onMicrophoneActive),"cameraActiveCallbacks"in this._session&&(this._session.cameraActiveCallbacks=this._onCameraActive),this._session.features.isIos&&document.addEventListener("visibilitychange",this.visibilityChange),[4,function e(t,n,o){return void 0===n&&(n={}),b(this,void 0,void 0,function(){var e,r,i,s,a,c;return $(this,function(u){switch(u.label){case 0:e=[],r=n.maxRetries||50,i=n.delayMs||200,a=0,u.label=1;case 1:if(!(a<r))return[3,8];u.label=2;case 2:return u.trys.push([2,4,,6]),[4,t()];case 3:return s=u.sent(),o.connectionResult={message:"success",value:s,retries:e},[3,6];case 4:var l;if(c=u.sent(),e.push(c),o.connectionResult={message:"failed",retries:e},!(c instanceof Error)||"noScene"!==c.name)throw c;if(e.length===r)throw console.warn("Retry gave up after "+r+" retries:\n"+e.map(function(e){return e instanceof Error?e.message:e.toString()}).join("\n")),c;return[4,(l=i,new Promise(function(e){return setTimeout(function(){return e()},l)}))];case 5:return u.sent(),[3,7];case 6:return[3,8];case 7:return a++,[3,1];case 8:return[2,s]}})})}(function(){return b(l,void 0,void 0,function(){return $(this,function(e){switch(e.label){case 0:return[4,this._session.connect()];case 1:return[2,e.sent()]}})})},i.retryOptions,this),];case 6:return[2,d.sent()]}})})},e.prototype.onMessage=function(e){if("scene"===e.category){this.onSceneMessage(e);return}},e.prototype.sendOnewaySceneRequest=function(e,t){if(this._session){var n={name:e,body:t,category:r.Scene,kind:i.Request};this._session.sendMessage(n)}},e.prototype.sendRequest=function(e,t){var n=this;return void 0===t&&(t={}),new Promise(function(o,s){if(!n._session){s(q("No session available","noSession"));return}var a=n._sceneId+"_"+ ++n._transactionId,c={transaction:a,name:e,body:t,category:r.Scene,kind:i.Request};console.log("sssss",c),n._pendingResponses[a]={resolve:o,reject:s},n._session&&n._session.sendMessage(c)})},e.prototype.onSceneMessage=function(e){var t,n=e.name,o=e.body,r=e.kind,s=e.status,a=e.transaction;if(o&&"state"===n){var c=o;this._onStateEvent.call(this,c),(null===(t=c.scene)||void 0===t?void 0:t.featureFlags)&&this.enableFlaggedFeatures(c.scene.featureFlags),this.controlMicrophoneMute(o)}else if(o&&"recognizeResults"===n){var u=o,l=u.status,d=u.errorMessage,p=u.results;this._onRecognizeResultsEvent.call(this,l,d,p)}else if(o&&"conversationResult"===n){var f=o.personaId;if(f){var g=new h(this,f),v=this._onConversationResultEvents[f];v.call(g,o)}}else if(o&&"speechMarker"===n){var f=o.personaId;if(f){var g=new h(this,f),v=this._onSpeechMarkerEvents[f];v.call(g,o)}}else o&&"demoMode"===n&&this._onDemoModeEvent.call(this,o);r===i.Response&&a&&this.processResponse(o,n,s,a)},e.prototype.processResponse=function(e,t,n,o){var r=this._pendingResponses[o];if(r){if(0===n)r.resolve(e);else{var i=new G;i.requestName=t,i.status=n,i.responseBody=e,r.reject(i)}delete this._pendingResponses[o]}},e.prototype.controlMicrophoneMute=function(e){var t=this;if(e.persona&&this._session&&-1!==this._session.microphoneMuteDelay)for(var n in e.persona){var o=e.persona[n];o.speechState&&(o.speechState===s.Speaking?(this._session.microphoneMuted||(this._session.log("Persona is speaking - mute microphone"),this._session.microphoneMuted=!0),this._microphoneUnmuteTimer&&(clearTimeout(this._microphoneUnmuteTimer),this._microphoneUnmuteTimer=void 0)):this._session.microphoneMuted&&!this._microphoneUnmuteTimer&&(this._microphoneUnmuteTimer=setTimeout(function(){t._session&&t._microphoneUnmuteTimer&&(t._session.log("Persona is no longer speaking - unmute microphone"),t._session.microphoneMuted=!1,t._microphoneUnmuteTimer=void 0)},this._session.microphoneMuteDelay)))}},e.prototype.close=function(){this._session&&this._session.close(!0)},e.prototype.sessionClosed=function(e){this._session&&(this._session.features.isIos&&document.removeEventListener("visibilitychange",this.visibilityChange),this._onDisconnectedEvent.call(this,this._session.sessionId,e))},e.prototype.rtcUserText=function(e){this._onUserTextEvent.call(this,e)},e.prototype.enableFlaggedFeatures=function(e){e.includes(a.UI_CONTENT_AWARENESS)&&!this.contentAwareness&&(this.contentAwareness=new eV(this,this.contentAwarenessDebounceTime,new V(this._loggingConfig.contentAwareness.minLogLevel,this._loggingConfig.contentAwareness.enabled))),this._serverControlledCameras=e.includes(a.UI_SDK_CAMERA_CONTROL)},e.prototype.sendContent=function(){var e;this.contentAwareness||console.warn("ContentAwareness is not enabled for this project"),null===(e=this.contentAwareness)||void 0===e||e.measure()},e.prototype.sendVideoBounds=function(e,t){this._session&&this._session.sendVideoBounds(e,t)},e.prototype.configure=function(e){return this.sendRequest("configure",e)},e.prototype.sendUserText=function(e){this._session&&this._session.sendUserText(e)},e.prototype.startRecognize=function(e){var t={};return void 0!==e&&(t.audioSource=e),this.sendRequest("startRecognize",t)},e.prototype.stopRecognize=function(){return this.sendRequest("stopRecognize")},e.prototype.isMicrophoneConnected=function(){return!!this._session&&this._session.isMicrophoneConnected},e.prototype.isCameraConnected=function(){return!!this._session&&this._session.isCameraConnected},e.prototype.session=function(){return this._session},e.prototype.hasContentAwareness=function(){return!!this.contentAwareness},e.prototype.hasServerControlledCameras=function(){return this._serverControlledCameras},Object.defineProperty(e.prototype,"onConversationResultEvents",{get:function(){return this._onConversationResultEvents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSpeechMarkerEvents",{get:function(){return this._onSpeechMarkerEvents},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return b(this,void 0,Promise,function(){return $(this,function(e){return[2,this.sendRequest("getState")]})})},Object.defineProperty(e.prototype,"onStateEvent",{get:function(){return this._onStateEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onState",{set:function(e){this._onState=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDisconnectedEvent",{get:function(){return this._onDisconnectedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDisconnected",{set:function(e){this._onDisconnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecognizeResultsEvent",{get:function(){return this._onRecognizeResultsEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecognizeResults",{set:function(e){this._onRecognizeResults=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserTextEvent",{get:function(){return this._onUserTextEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"echoCancellationEnabled",{get:function(){return this._echoCancellationEnabled},set:function(e){this._echoCancellationEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDemoModeEvent",{get:function(){return this._onDemoModeEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoElement",{get:function(){return this._videoElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewerOffsetX",{get:function(){return this._session?this._session.offsetX:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewerOffsetY",{get:function(){return this._session?this._session.offsetY:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWebSocketOnly",{get:function(){return this._isWebSocketOnly},set:function(e){this._isWebSocketOnly=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMicrophoneActive",{get:function(){return this._onMicrophoneActive},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){var e;return Boolean(null===(e=this._session)||void 0===e?void 0:e.isMicrophoneActive())},Object.defineProperty(e.prototype,"onCameraActive",{get:function(){return this._onCameraActive},enumerable:!1,configurable:!0}),e.prototype.isCameraActive=function(){var e;return Boolean(null===(e=this._session)||void 0===e?void 0:e.isCameraActive())},e.prototype.setMediaDeviceActive=function(e){var t;return b(this,void 0,Promise,function(){return $(this,function(n){switch(n.label){case 0:if(!this.isConnected())return[3,2];return[4,null===(t=this._session)||void 0===t?void 0:t.setMediaDeviceActive({microphone:e.microphone,camera:e.camera}),];case 1:return n.sent(),[3,3];case 2:throw q("Connection has not been established","noConnection");case 3:return[2]}})})},e.prototype.startVideo=function(e){return b(this,void 0,Promise,function(){var t;return $(this,function(n){switch(n.label){case 0:if(!(t=e||this._videoElement))throw q("Cannot find HTMLVideoElement","noVideoElement");return[4,this.playVideo(t)];case 1:if(n.sent())return[2,{video:!0,audio:!0},];return t.muted=!0,[4,this.playVideo(t)];case 2:if(n.sent())return[2,{video:!0,audio:!1},];throw q("Cannot start media playback","userInteractionRequired")}})})},e.prototype.playVideo=function(e){return b(this,void 0,Promise,function(){var t;return $(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.play()];case 1:return n.sent(),[2,!0];case 2:return t=n.sent(),[2,!1];case 3:return[2]}})})},e.prototype.fetchAuthConfig=function(e){var t=JSON.parse(atob(e));return fetch(t.authServer,{headers:{key:e}})},e.prototype.connectArgsToConfig=function(e,t,n,o){var r,i;return"string"==typeof e?{tokenServerUri:e,tokenServerAccessToken:n,userText:t,retryOptions:o}:{tokenServerUri:(null===(r=null==e?void 0:e.tokenServer)||void 0===r?void 0:r.uri)||"",tokenServerAccessToken:null===(i=null==e?void 0:e.tokenServer)||void 0===i?void 0:i.token,userText:null==e?void 0:e.userText,retryOptions:null==e?void 0:e.retryOptions}},e}();(et=l||(l={}))[et.none=o.None]="none",et[et.microphone=o.Microphone]="microphone",et[et.microphoneAndCamera=o.MicrophoneAndCamera]="microphoneAndCamera",et[et.camera=o.Camera]="camera";var ez=new function e(){this.Scene=eF,this.Persona=h,this.userMedia={none:o.None,microphone:o.Microphone,microphoneAndCamera:o.MicrophoneAndCamera,camera:o.Camera},this.DetectCapabilities=function(){return new N().detectWebRTCFeatures()},this.setLogging=function(e){}};function e0(){return new N().detectWebRTCFeatures()}function eW(e){}}])});